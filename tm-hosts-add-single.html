<h2> Add single host </h2>
<div class="base">
	<div class="row">			
		<div class="col">
		
			<div class="row">
				<div class="col-md-6">

					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text mb-2 input-group-text-ba">Hostname:</span>
							<span id="tagIdTxtPrefix" class="input-group-text text-success bg-white mb-2"></span>
							<span id="tagIdTxtPrefixPlus"class="input-group-text mb-2">+</span>
						</div>
						<input type="text" id="tagIdInpHostName" value=""class="form-control mb-2" autocomplete="off" placeholder="Type here">
							<button id="tagIdDdnHostType" class="btn btn-secondary dropdown-toggle ml-2 mb-2" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
							<div class="dropdown-menu">
								<a class="dropdown-item" onclick="handleDropDown(0) "href="#">ESX</a>
								<a class="dropdown-item" onclick="handleDropDown(1) "href="#">Oracle</a>
								<a class="dropdown-item" onclick="handleDropDown(2) "href="#">MS-SQL</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" onclick="handleDropDown(3) "href="#">Custom host</a>
								
							</div>
					</div> 

					<div id="tagIdInpPrefixGroup" class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text mb-2 input-group-text-ba">Prefix:</span>
						</div>
						<input type="text" id="tagIdInpPrefix" value=""class="form-control mb-2"  autocomplete="off" placeholder="Type here">
					</div>
					
					<div id="tagIdTxtMacroGroup" class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text mb-2 input-group-text-ba">Macro:</span>
							<span id="tagIdTxtMacroName" class="input-group-text bg-white mb-2">{$ORAOID}</span>
							<span id="tagIdTxtMacroGleich"class="input-group-text mb-2">=</span>
							<span id="tagIdTxtMacroValue" class="input-group-text text-success bg-white mb-2"></span>
						</div>
					</div> 
					
				</div>	
			</div>
			
			<div class="row">
				<div class="col-md-6">
					<p id="msgLine1" class="text-danger ml-2"></p>
				</div>
			</div>	
				
			<div class="row">
				<div class="col-md-6">
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text mb-2 input-group-text-ba">Template 1:</span>
						</div>
						<input type="text" id="tagIdInpTemplate0" value="" class="form-control mb-2"  data-toggle="dropdown" autocomplete="off" placeholder="Type here">
						<div id="tagIdDdnTemplate0" class="dropdown-menu mt-2"></div>
					</div>
					
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text mb-2 input-group-text-ba">Template 2:</span>
						</div>
						<input type="text" id="tagIdInpTemplate1" value="" class="form-control mb-2"  autocomplete="off" placeholder="Type here">
					</div>					
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text mb-2 input-group-text-ba">Group 1:</span>
						</div>
						<input type="text" id="tagIdInpGroup0" value="" class="form-control mb-2"  autocomplete="off" placeholder="Type here">
					</div>
					<div class="input-group">
						<div class="input-group-prepend">
							<span class="input-group-text mb-2 input-group-text-ba">Group 2:</span>
						</div>
						<input type="text" id="tagIdInpGroup1" value="" class="form-control mb-2"  autocomplete="off" placeholder="Type here">
					</div>
				</div>
			</div>
			
			<div class="row">
				<div class="col-md-6">
					<p id="msgLine2" class="text-danger ml-2"></p>
					<button id="tagIdBtnCreateHost" onclick="handleCreateHost()" type="button" class="btn float-right btn-primary	mb-2">Create Host</button>
				</div>
			</div>						
					
			<div class="row">
				<div class="col-md-6">
					<div id="msgAlertHostSuccessful" class="alert alert-success" role="alert"> Host created successful !</div>
				</div>
			</div>
					
		</div> 	
				
	</div>		
</div>

<script type="text/JavaScript">


//------------------------------------------------------------------------------------------
// Gobals
//------------------------------------------------------------------------------------------

const	ESX    = 0;
const	ORACLE = 1;
const	MSSQL  = 2;		
const	CUSTOM = 3;		 

var 	HOST_TYPES = [

			{ 	label:"ESX",         
				prefix:"",         
				templates:[{templateid:"10001"},{templateid:"10065"}], 
				groups: [{groupid:"2"},{groupid:"6"}],
				macros: [{macro:"",value:""}]		
			},
			
			{ 	label:"Oracle",      
				prefix:"ora1",     
				templates:[{templateid:"10001"},{templateid:"10065"}], 
				groups: [{groupid:"2"},{groupid:"6"}],
				macros: [{macro:"{$ORAOID}",value:""}]						
			},				
			
			{ 	label:"MS-SQL",      
				prefix:"sql-pe1-", 
				templates:[{templateid:"10001"},{templateid:"10065"}], 
				groups: [{groupid:"2"},{groupid:"6"}] ,
				macros: [{macro:"{$DB_INST}",value:""}]		
			},				
			
			{ 	label:"Custom host", 
				prefix:"",         
				templates:[{templateid:""},{templateid:""}], 
				groups: [{groupid:""},{groupid:""}],
				macros: [{macro:"",value:""}]
			}				
		];
		
var		HOST_TYPE;

//------------------------------------------------------------------------------------------
$(document).ready(function() {

	HOST_TYPE = ESX;
	prefillForm (HOST_TYPE);
	setMsgLine1('');
	setMsgLine2('');
	document.getElementById("tagIdBtnCreateHost").setAttribute("disabled",""); 
	
	$("#msgAlertHostSuccessful").hide();
	
}); 
//------------------------------------------------------------------------------------------
function setMsgLine1(msg) {

	if (msg != '') {
		document.getElementById("msgLine1").innerHTML = msg;
	} else {
		document.getElementById("msgLine1").innerHTML = '&nbsp;';
	}
}
//------------------------------------------------------------------------------------------
function setMsgLine2(msg) {

	if (msg != '') {
		document.getElementById("msgLine2").innerHTML = msg;
	} else {
		document.getElementById("msgLine2").innerHTML = '&nbsp;';
	}
}
//------------------------------------------------------------------------------------------
function prefillForm (hostType) {

	document.getElementById("tagIdInpHostName").value = '';
	document.getElementById("tagIdDdnHostType").innerHTML = HOST_TYPES[hostType].label;
	document.getElementById("tagIdBtnCreateHost").setAttribute("disabled","");

	if (HOST_TYPES[HOST_TYPE].prefix != '') {	
		$("#tagIdTxtPrefix").show();
		$("#tagIdTxtPrefixPlus").show();
		$("#tagIdInpPrefixGroup").show();
		$("#tagIdTxtMacroGroup").show();
		document.getElementById("tagIdTxtPrefix").innerHTML = HOST_TYPES[hostType].prefix;
		document.getElementById("tagIdInpPrefix").value = HOST_TYPES[hostType].prefix;
		document.getElementById("tagIdTxtMacroName").innerHTML = HOST_TYPES[hostType].macros[0].macro;
		document.getElementById("tagIdTxtMacroValue").innerHTML = HOST_TYPES[hostType].macros[0].value;
	} 
	else {
		$("#tagIdTxtPrefix").hide();
		$("#tagIdTxtPrefixPlus").hide();
		$("#tagIdInpPrefixGroup").hide();
		$("#tagIdTxtMacroGroup").hide();
	}
	
	// Templates
	var templates = HOST_TYPES[hostType].templates;	
	for (var t in templates) {	
		setTemplateName(templates[t].templateid, document.getElementById("tagIdInpTemplate"+t));
	}
	
	// Groups
	var groups = HOST_TYPES[hostType].groups;	
	for (var g in groups) {
		setGroupName(groups[g].groupid, document.getElementById("tagIdInpGroup"+g));
	}
}

//------------------------------------------------------------------------------------------
function setTemplateName(templateId, tag) {

	$.get("http://svx-zabbixp001/api-get-template-name.php"+"?templateid="+templateId+"&rand="+Math.floor(Math.random()*100), function(data) {
	
		var templates = JSON.parse(data).result;
		if (templateId) {
			tag.value = templates[0].name;
		}
		else {
			tag.value = '';
		}	
		
	}); //end get()					
}

//------------------------------------------------------------------------------------------
function setGroupName(groupId, tag) {

	$.get("http://svx-zabbixp001/api-get-group-name.php"+"?groupid="+groupId+"&rand="+Math.floor(Math.random()*100), function(data) {
	
		var groups = JSON.parse(data).result;		
		if (groupId) {
			tag.value = groups[0].name;
		}
		else {
			tag.value = '';
		}	
		
	}); //end get()					
}
//------------------------------------------------------------------------------------------
$("#tagIdInpPrefix").keyup(function(event) {

	var prefix = document.querySelector("#tagIdInpPrefix").value;
	
	if (prefix != '') {
		validateHostName = new RegExp(/^[a-zA-Z]+[a-zA-Z0-9\-\_\.]*$/);
		if (prefix.match(validateHostName) != null) {
			document.getElementById("tagIdTxtPrefix").innerHTML = prefix;
			setMsgLine1('');
		}
		else {
			setMsgLine1('Character not allowed');
		}
	} 
	else {
		setMsgLine1(''); 
		document.getElementById("tagIdTxtPrefix").innerHTML = '';
	}
});
//------------------------------------------------------------------------------------------
$("#tagIdInpHostName").keyup(function(event) {
		
	// enter key
	if (event.keyCode === 13) {
		handleApplyButton();
		
	// all other keys	
	} else {	
	
		var host = document.querySelector("#tagIdInpHostName").value;
		//host = host.replace(/^\s*|\s*$/g,'');
		if (host != '') {
			if (HOST_TYPES[HOST_TYPE].prefix == '') {
				validateHostName = new RegExp(/^[a-zA-Z]+[a-zA-Z0-9\-\_\.]*$/);
			}
			else {
				validateHostName = new RegExp(/^[a-zA-Z0-9\-\_\.]*$/);
			}			
			if (host.match(validateHostName) != null) {
				document.getElementById("tagIdTxtMacroValue").innerHTML = host;
				document.getElementById("tagIdBtnCreateHost").removeAttribute("disabled","");
				setMsgLine1('');
			}
			else {
				document.getElementById("tagIdBtnCreateHost").setAttribute("disabled","");
				setMsgLine1('Character not allowed');
			}
		} 
		else {
			setMsgLine1(''); 
			document.getElementById("tagIdBtnCreateHost").setAttribute("disabled","");
			document.getElementById("tagIdTxtMacroValue").innerHTML = '';
			
		}		
	}
});	

//------------------------------------------------------------------------------------------
$("#tagIdInpTemplate0").keyup(function(event) {

	console.log("hi");
	// enter key
	if (event.keyCode === 13) {
		handleApplyButton();
		
	  //space and all other keys		
	} else if (event.keyCode === 32 || event.keyCode != 0) {
	
		//document.getElementById("applyButton").setAttribute("disabled","");
		setMsgLine2('');
		
		var host = document.querySelector("#tagIdInpTemplate0").value;
		//clear space
		host = host.replace(/^\s*|\s*$/g,'');
		
		if (host != '') {		
			console.log("host:"+host);
			// get the search result host list (max. 15) as JSON string
			$.get("http://svx-zabbixp001/api-search-template.php"+"?template="+host+"&rand="+Math.floor(Math.random()*100), function(data) {
			
				var results = JSON.parse(data).result;
				console.log(results);
				var dropDownList = '';
				
				for (var r in results) {			
					posHL = results[r].name.search(new RegExp(host,'i'));
					sizeHL = host.length;
					stringHL = results[r].name.substring(posHL, posHL+sizeHL);
					stringHLRegex = new RegExp(stringHL);
					hostHL = results[r].name.replace(stringHLRegex,'<span class="text-danger">'+stringHL+'</span>');
					dropDownList += '<a href="#" class="dropdown-item" onclick="selectHost(\''+results[r].name+'\',\''+results[r].templateid+'\')">'+hostHL+'</a>';
				}
				if (dropDownList != '') {
					document.getElementById("tagIdDdnTemplate0").innerHTML = dropDownList;
					setMsgLine2('');
					$("#tagIdDdnTemplate0").show();
				} else {
					setMsgLine2('No matches found');
					$("#tagIdDdnTemplate0").hide();
				}	
			}); //end get()
		}
		else {
			$("#tagIdDdnTemplate0").hide();
		}
	}
});

//------------------------------------------------------------------------------------------
function handleCreateHost() {	

	
}
//------------------------------------------------------------------------------------------
function handleDropDown(hostType) {	

	HOST_TYPE = hostType;
	prefillForm(hostType);
	
}
		
</script>	